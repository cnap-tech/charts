# Cloudflare Gateway Configuration
# Reference: https://github.com/pl4nty/cloudflare-kubernetes-gateway

# CNAP proxy credentials (set by CNAP when deploying gateways)
# When set, these take precedence over `cloudflare.*` values.
credentials:
  # Cloudflare Account ID
  accountId: ''
  # Proxy token (bearer token for CNAP proxy, NOT a raw CF API token)
  token: ''
  # CNAP proxy base URL (e.g., https://dash.cnap.tech/api/cloudflare)
  apiBaseUrl: ''
  # Configuration mode: 'local' (CNAP-managed) or 'remote' (customer's CF account)
  configMode: ''

# Standalone Cloudflare credentials (used when NOT deployed through CNAP proxy)
cloudflare:
  # Your Cloudflare account ID (found in dashboard URL)
  accountId: ''
  # API token with "Account Cloudflare Tunnel Edit" and "Zone DNS Edit" permissions
  apiToken: ''
  # Alternatively, reference an existing secret
  existingSecret: ''
  # Secret key names (if using existingSecret)
  secretKeys:
    accountId: 'ACCOUNT_ID'
    token: 'TOKEN'

# Controller configuration
controller:
  # Enable controller deployment (disable if using standalone installation)
  enabled: true

  # Image configuration
  image:
    repository: ghcr.io/cnap-tech/cloudflare-kubernetes-gateway
    tag: 'latest'
    pullPolicy: IfNotPresent

  # Controller namespace (where controller runs)
  namespace: cloudflare-gateway

  # Resource limits
  resources:
    limits:
      cpu: 500m
      memory: 128Mi
    requests:
      cpu: 10m
      memory: 64Mi

  # Replica count
  replicas: 1

  # Service account
  serviceAccount:
    create: true
    name: ''
    annotations: {}

  # Pod security context
  securityContext:
    runAsNonRoot: true
    seccompProfile:
      type: RuntimeDefault

# GatewayClass configuration
gatewayClass:
  # Name of the GatewayClass
  name: cloudflare
  # Description
  description: 'Cloudflare Tunnel Gateway'

# Gateway configuration
gateway:
  # Enable Gateway creation
  enabled: true
  # Gateway name
  name: cloudflare-gateway
  # NOTE: Namespace is controlled by Helm release namespace (namespace agnostic)
  # Set via ArgoCD destination.namespace or helm install --namespace

  # Listeners
  listeners:
    - name: http
      protocol: HTTP
      port: 80
    # Add HTTPS listener if needed (Cloudflare handles TLS at edge)
    # - name: https
    #   protocol: HTTPS
    #   port: 443

  # Infrastructure config (for standalone cloudflared)
  infrastructure:
    # Disable built-in cloudflared deployment per Gateway
    disableDeployment: false

  # Labels and annotations
  labels: {}
  annotations: {}

# Cloudflared sidecar configuration (per-gateway tunnel client)
cloudflared:
  # Resource limits for cloudflared containers
  resources:
    limits:
      cpu: 500m
      memory: 128Mi
    requests:
      cpu: 10m
      memory: 64Mi

# RBAC configuration
rbac:
  create: true

# Name overrides
nameOverride: ''
fullnameOverride: ''
